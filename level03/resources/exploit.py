#!/usr/bin/env python2

import os
import struct
import subprocess
import binascii
import tempfile
import select
import sys

elf = "/home/users/level03/level03"

for i in range(1, 22):
    payload = str(322424845 - i)

    # Start the process
    p = subprocess.Popen(elf, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)

    # Send the payload
    p.stdin.write(payload + "\n")
    p.stdin.flush()

    # Now, interact with the process
    while p.poll() is None:
        ready, _, _ = select.select([p.stdout, p.stderr, sys.stdin], [], [])  # Wait for input from stdout, stderr, or user

        for stream in ready:
            if stream is p.stdout:
                output = p.stdout.readline()
                if "Invalid Password" in output.strip():
                    p.kill()
                    break
                #print output.strip()
                sys.stdout.write(output)
            elif stream is p.stderr:
                output = p.stderr.readline()
                #print output.strip()
                sys.stdout.write(output)
            elif stream is sys.stdin:
                user_input = sys.stdin.readline().strip()
                p.stdin.write(user_input + "\n")
                p.stdin.flush()

    # Handle process exit
    exit_code = p.wait()
    if exit_code < 0:
        print("The process crashed with signal {}".format(-exit_code))
    elif exit_code > 0:
        print("The process exited with status {}".format(exit_code))
    else:
        print("The process exited successfully")
